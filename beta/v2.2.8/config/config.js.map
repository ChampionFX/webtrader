{"version":3,"sources":["../../../../src/config/config.es6"],"names":["win","win_view","initConfigWindow","root","html","i18n","state","init_state","rv","bind","windows","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","modal","ignoreTileAction","open","config","local_storage","get","app_id","websocket_url","_","replace","oauth_url","close","unbind","dialog","remove","buttons","text","icons","primary","click","apply","reset","lang","value","set","reload_page","$","growl","notice","message","setTimeout","window","location","reload","init","$menuLink","moveToTop"],"mappings":"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","file":"config.js","sourcesContent":["/**\n* Created by arnab on 5/12/16.\n*/\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport rv from '../common/rivetsExtra';\nimport _ from 'lodash';\nimport '../common/util';\nimport html from 'text!./config.html';\nimport 'css!./config.css';\n\nlet win = null, win_view = null;\n\nconst initConfigWindow = () => {\n   const root = $(html).i18n();\n   const state = init_state(root);\n   win_view = rv.bind(root[0], state);\n\n   win = windows.createBlankWindow(root, {\n      title: 'Change Backend Server'.i18n(),\n      resizable: false,\n      collapsable: false,\n      minimizable: false,\n      maximizable: false,\n      modal: true,\n      ignoreTileAction:true,\n      open: () => {\n         const config = local_storage.get('config');\n         if(config && config.app_id) state.app_id = config.app_id;\n         if(config && config.websocket_url) state.websocket_url = _.replace(_.replace(config.websocket_url || '', 'wss://', ''), '/websockets/v3?l=EN', '');\n         if(config && config.oauth_url) state.oauth_url = _.replace(_.replace(config.oauth_url || '', 'https://', ''), '/oauth2/authorize', '');\n      },\n      close: () => {\n         win_view && win_view.unbind();\n         win && win.dialog('destroy').remove();\n         win_view = win = null;\n      },\n      buttons: [\n         {\n            text: 'Apply'.i18n(),\n            icons: { primary: 'ui-icon-check' },\n            click: state.apply\n         },\n         {\n            text: 'Reset to Defaults'.i18n(),\n            icons: { primary: 'ui-icon-refresh' },\n            click: state.reset\n         }\n      ]\n   });\n\n   win.dialog( 'open' );\n}\n\nconst init_state = (root) => {\n   const state = {\n      websocket_url: 'ws.binaryws.com',\n      oauth_url: 'oauth.binary.com',\n      app_id: ''\n   };\n\n   state.apply = () => {\n      const lang = (local_storage.get('i18n') || {value:'en'}).value;\n      const config = {\n         websocket_url: 'wss://' + state.websocket_url + '/websockets/v3?l=' + lang,\n         oauth_url: 'https://' + state.oauth_url + '/oauth2/authorize',\n         app_id: state.app_id\n      }\n      local_storage.set('config', config);\n      state.reload_page();\n   }\n\n   state.reset = () => {\n      local_storage.remove('config');\n      state.reload_page();\n   }\n\n   state.reload_page = () => {\n      $.growl.notice({message: 'Config changes successful.<br/>Reloading page ...'.i18n()});\n      setTimeout(() => {\n         window.location.reload();\n      }, 900);\n   }\n\n   return state;\n}\n\n\nexport const init = ($menuLink) => {\n   $menuLink.click(() => {\n      if (!win)\n         initConfigWindow();\n      else\n         win.moveToTop();\n   });\n}\n\nexport default { init }\n"]}