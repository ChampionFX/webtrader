{"version":3,"sources":["../../../../src/oauth/login.es6"],"names":["login_win","login_win_view","DEFAULT_SERVER_URL","init","moveToTop","root","$","html","i18n","windows","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","width","height","close","dialog","remove","open","destroy","unbind","parent","css","init_state","offset","top","my","left","at","find","win","app_id","liveapi","state","route","value","login","disabled","registration","email","validate","email_show_explanation","validateEmail","account","empty_fields","clear","_","debounce","show","password_error_message","password","length","test","verification","repeat_password","residence","residence_list","text","residence_unsupported","confirm","server_url","oauth_url","window","location","update","routes","create","send","verify_email","type","then","data","growl","notice","message","msg_type","catch","err","console","error","ok","request","new_account_virtual","verification_code","client_password","oauth","id","client_id","token","oauth_token","local_storage","set","cached","authorize","rv","bind","map","r","push","website_status","clients_country","indexOf"],"mappings":"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","file":"login.js","sourcesContent":["/*\n * Created by amin on May 1, 2016.\n */\n\nimport liveapi from '../websockets/binary_websockets';\nimport windows from '../windows/windows';\nimport rv from '../common/rivetsExtra';\nimport _ from 'lodash';\nimport html from 'text!./login.html';\nimport 'css!./login.css';\n\nlet login_win = null;\nlet login_win_view = null; // rivets view\nconst DEFAULT_SERVER_URL = 'oauth.champion-fx.com';\n\nexport const init = () => {\n   if(login_win){\n      login_win.moveToTop();\n      return;\n   }\n\n   const root = $(html).i18n();\n   login_win = windows.createBlankWindow(root, {\n      title: 'Log in',\n      resizable:false,\n      collapsable:false,\n      minimizable: false,\n      maximizable: false,\n      width: 548,\n      height: 'auto',\n      close: () => {\n         login_win.dialog('destroy');\n         login_win.remove();\n         login_win = null;\n      },\n      open: () => { },\n      destroy: () => {\n         login_win_view && login_win_view.unbind();\n         login_win_view = null;\n      }\n   });\n   login_win.parent().css('overflow', 'visible');\n\n   init_state(root, login_win);\n   login_win.dialog('open');\n\n   /* update dialog position, this way when dialog is resized it will not move*/\n   const offset = login_win.dialog('widget').offset();\n   offset.top = 120;\n   login_win.dialog(\"option\", \"position\", { my: offset.left, at: offset.top });\n   login_win.dialog('widget').css({\n      left: offset.left + 'px',\n      top: offset.top + 'px'\n   });\n   login_win.dialog('widget').find('.ui-selectmenu-menu ul').css('max-height', '320px');\n}\n\nconst init_state = (root, win) => {\n   const app_id = liveapi.app_id;\n   const state = {\n      route: { value: 'login' },\n      login: { disabled: false },\n      registration: {\n         email: '',\n         disabled: false,\n         validate: { value: false },\n         email_show_explanation: () => {\n            const email = state.registration.email;\n            return (email === '' && !state.registration.validate.value) || validateEmail(email);\n         },\n      },\n      account: {\n         empty_fields: {\n            validate: false,\n            clear: _.debounce(() => {\n               state.account.empty_fields.validate = false;\n            }, 2000),\n            show: () => {\n               state.account.empty_fields.validate = true;\n               state.account.empty_fields.clear();\n            }\n         },\n         password_error_message: () => {\n            const password = state.account.password;\n            if(password === '') return state.account.empty_fields.validate ? 'You should enter between 6-25 characters.'.i18n() : '';\n            if(password.length < 6) return 'Password must be 6 characters minimum'.i18n();\n            if(!/\\d/.test(password) || !/[a-z]/.test(password) || !/[A-Z]/.test(password)) return 'Password must contain lower and uppercase letters with numbers'.i18n();\n            return '';\n         },\n         verification: '',\n         password: '',\n         repeat_password:  '',\n         residence: '',\n         residence_list: [ { text: 'Indonesia', value: 'id'}],\n         residence_unsupported: [],\n         disabled: false, /* is button disabled */\n      },\n      confirm: { disabled: false }\n   };\n\n   state.login.login = () => {\n      state.login.disabled = true;\n      const server_url = liveapi.server_url || DEFAULT_SERVER_URL;\n      const oauth_url = `https://${server_url}/oauth2/authorize`;\n      window.location =  oauth_url + '?app_id=' + app_id;\n   }\n\n   state.confirm.confirm = () => {\n      state.confirm.disabled = true;\n      const server_url = liveapi.server_url || DEFAULT_SERVER_URL;\n      const oauth_url = `https://${server_url}/oauth2/authorize`;\n      window.location =  oauth_url + '?app_id=' + app_id;\n   }\n\n   state.route.update = (route) => {\n      const routes = {\n         login: {\n            title: 'Log in'.i18n(),\n            height: 180\n         },\n         registration: {\n            title: 'Registration'.i18n(),\n            height: 220,\n         },\n         account: {\n            title: 'Account opening'.i18n(),\n            height: 465\n         },\n         confirm: {\n            title: 'Account opening'.i18n(),\n            height: 415\n         }\n      };\n      state.route.value = route;\n      const title = routes[route].title;\n      const height = routes[route].height;\n      win.dialog('option', 'title', title);\n      win.dialog('option', 'height', height);\n   };\n\n   state.registration.validate.clear = _.debounce(() => {\n      state.registration.validate.value = false;\n   }, 2000);\n\n   state.registration.validate.show = () => {\n      state.registration.validate.value = true;\n      state.registration.validate.clear();\n   }\n\n   /* { verify_email: 'email' } step */\n   state.registration.create = () => {\n      const email = state.registration.email;\n      if(email == '' || !validateEmail(email)) {\n         state.registration.validate.show();\n         return;\n      }\n\n      state.registration.disabled = true;\n      liveapi.send({verify_email: email, type: 'account_opening'})\n         .then((data) => {\n            state.registration.disabled = false;\n            if(data.verify_email) {\n               $.growl.notice({ message: 'Verification code sent to '.i18n() + email });\n               state.route.update('account');\n            }\n            else  {\n               throw { message: 'Email verification failed ('.i18n() + data.msg_type + ')' };\n            }\n         })\n         .catch((err) => {\n            console.error(err);\n            $.growl.error({ message: err.message });\n            state.registration.disabled = false;\n         });\n   }\n\n   /* { new_account_virtual: 1 } step */\n   state.account.open = () => {\n      state.account.empty_fields.show();\n      const email = state.registration.email,\n         verification = state.account.verification,\n         password = state.account.password,\n         repeat_password = state.account.repeat_password,\n         residence = state.account.residence;\n      let ok = validateEmail(email) && verification !== '' && password === repeat_password && password.length >= 6;\n      ok = ok && /\\d/.test(password) && /[a-z]/.test(password) && /[A-Z]/.test(password)  && residence.length === 2;\n\n      if(!ok) { return; }\n\n      const request = {\n         new_account_virtual: 1,\n         verification_code: verification,\n         client_password: password,\n         residence: residence,\n         // affilate_token: '???'\n      };\n      state.account.disabled = true;\n      liveapi.send(request)\n         .then((data) => {\n            const account = data.new_account_virtual;\n            const oauth = [{id: account.client_id, token: account.oauth_token }];\n            local_storage.set('oauth', oauth);\n            state.account.disabled = false;\n            liveapi.cached.authorize()\n               .then(() => {\n                  win.dialog('destroy'); \n                  win.remove();\n                  login_win = null;\n               })\n               .catch(\n                  (err) => console.error(err.message)\n               );\n            //state.route.update('confirm');\n         })\n         .catch((err) => {\n            console.error(err);\n            $.growl.error({ message: err.message });\n            state.account.disabled = false;\n         });\n   }\n\n   login_win_view = rv.bind(root[0], state);\n\n   liveapi.cached.send({residence_list: 1})\n      .then((data) => {\n         state.account.residence_list = data.residence_list.map((r) => {\n            r.disabled = (r.disabled === 'DISABLED' || r.disabled === true);\n            r.disabled && state.account.residence_unsupported.push(r.value);\n            return r;\n         });\n         state.account.residence = 'id'; // make indonesia default\n         liveapi.cached.send({website_status: 1})\n            .then((data) => {\n               const residence = data.website_status && data.website_status.clients_country;\n               if(state.account.residence_unsupported.indexOf(residence) === -1)\n                  state.account.residence = residence || 'id';\n            })\n            .catch((err) => {\n               console.error(err);\n               state.account.residence = 'id';\n            })\n      })\n      .catch((err) => {\n         console.error(err);\n         $.growl.error({ message: err.message });\n      });\n}\n\nexport const login = () => {\n   const app_id = liveapi.app_id;\n   const server_url = liveapi.server_url || DEFAULT_SERVER_URL;\n   const oauth_url = `https://${server_url}/oauth2/authorize`;\n   window.location =  oauth_url + '?app_id=' + app_id;\n}\n\nexport default {\n   init,\n   login\n}\n"]}