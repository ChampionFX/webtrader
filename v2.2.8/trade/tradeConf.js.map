{"version":3,"sources":["../../../../src/trade/tradeConf.es6"],"names":["display_decimals","rv","binders","priority","bind","el","model","chart","Highcharts","Chart","title","credits","enabled","type","renderTo","backgroundColor","width","getAttribute","height","marginLeft","tooltip","formatter","tick","array","x","xAxis","min","max","labels","yAxis","align","addComma","value","toFixed","gridLineWidth","series","data","marker","plotOptions","scatter","enableMouseTracking","exporting","enableImages","legend","routine","ticks","tick_idx","length","barrier","make_barrier","contract_is_finished","draw_barrier","draw_exit_spot","draw_tick","draw_entry_spot","is_path_dependent_contract","is_path_dependent","exit_tick_idx","findIndex","epoch","sell_spot_time","exit_tick_time","exit_spot","make_exit_spot","draw_x_line","addPoint","quote","is_label_left","entry_spot","make_entry_spot","removePlotLine","id","draw_y_line","options","align_label_left","label_x_position","addPlotLine","label","text","color","dashStyle","register_ticks","state","extra","proposal_open_contract","on_proposal_open_contract","on_tick","tick_count","add_tick","is_or_after_contract_entry","entry_tick_time","is_new_tick","some","state_tick","should_add_new_tick","status","buy","on_contract_finished","update_chart","add_tick_to_state","decimal_digits","chartingRequestMap","digits_after_decimal","pip","symbol","make_tooltip","push","number","tick_time","moment","utc","format","symbol_name","tick_quote_formatted","tick_arr_copy","slice","forget_stream_and_cb","update","back","visible","contract_id","liveapi","events","off","forget","on","is_different_open_contract_stream","error","on_open_proposal_error","temp_ticks","first_tick_epoch","is_getting_history","is_different_stream","has_missing_ticks","get_tick_history","forEach","stored_tick","start","ticks_history","send","end","style","count","then","history","prices","price","idx","times","sort","a","b","catch","err","$","growl","message","echo_req","subscribe","init","show_callback","hide_callback","root","html","i18n","longcode","balance_after","buy_price","currencyFractionalDigits","purchase_time","start_time","transaction_id","payout","currency","potential_profit","potential_profit_text","show_result","spreads","amount_per_point","stop_loss_level","stop_profit_level","inx","digits_value","category","category_display","chart_visible","show_tick_chart","arrow","contract_category","Lookback","isLookback","contract_type","formula","amount","undefined","waiting","won","lost","sell_expired","onclick","e","$target","target","hasClass","addClass","require","viewTransaction","removeClass","view"],"mappings":"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","file":"tradeConf.js","sourcesContent":["﻿import $ from 'jquery';\nimport moment from 'moment';\nimport liveapi from '../websockets/binary_websockets';\nimport rv from '../common/rivetsExtra';\nimport chartingRequestMap from '../charts/chartingRequestMap';\nimport html from 'text!../trade/tradeConf.html';\nimport 'css!../trade/tradeConf.css';\nimport Lookback from './lookback';\nimport '../common/util';\n\n/* rv binder to show tick chart for this confirmation dialog */\nlet display_decimals;\nrv.binders['tick-chart'] = {\n   priority: 65, /* a low priority to apply last */\n   bind: function(el) {\n      const model = this.model;\n      el.chart = new Highcharts.Chart({\n         title: '',\n         credits: {enabled: false},\n         chart: {\n            type: 'line',\n            renderTo: el,\n            backgroundColor: null, /* make background transparent */\n            width: (el.getAttribute('width') || 400)*1,\n            height: (el.getAttribute('height') || 120)*1,\n            marginLeft: 20,\n         },\n         tooltip: {\n            formatter: function () {\n               const tick = model.array[this.x-1];\n               return (tick && tick.tooltip) || false;\n            }\n         },\n         xAxis: {\n            type: 'linear',\n            min: 1,\n            max: el.getAttribute('tick-count')*1 + 1 /* exist spot vertical plot will not be at the end */,\n            labels: { enabled: false, }\n         },\n         yAxis: {\n            labels: {\n                  align: 'left',\n                  x: 0,\n                  formatter() {\n                        return addComma(this.value.toFixed(display_decimals));\n                  },\n            },\n            title: '',\n            gridLineWidth: 0,\n         },\n         series: [\n            { data: [] },\n            /* HighChart scales the y-axis automatically based on the maximum value of data.\n             * but it doesn't consider the plotLine's value in its calculations.\n             * We add an invisible seri and late plotline values to work around this issue. */\n            {\n               type: 'scatter',\n               marker: { enabled: false },\n               data: []\n            }\n         ],\n         plotOptions: { scatter: { enableMouseTracking: false } },\n         exporting: {enabled: false, enableImages: false},\n         legend: {enabled: false},\n      });\n   },\n   routine: function(el, ticks){\n      // Handles updating chart: state.ticks.array updates => routine fires\n      const model = this.model;\n      const tick_idx = ticks.length;\n      const barrier = model.make_barrier();\n      const { contract_is_finished } = model;\n\n      if (barrier) {\n            draw_barrier(barrier);\n      }\n\n      if (contract_is_finished) {\n            draw_exit_spot(model, ticks);\n            return;\n      }\n\n      if (tick_idx === 0) return;\n\n      draw_tick(tick_idx);\n\n      if (tick_idx === 1) {\n            draw_entry_spot(tick_idx);\n      }\n\n      function draw_exit_spot(model, ticks) {\n            const is_path_dependent_contract = !!model.is_path_dependent;\n            let exit_tick_idx = ticks.findIndex((tick) => {\n                  if (is_path_dependent_contract) {\n                        return tick.epoch === (+model.sell_spot_time);\n                  }\n                  return tick.epoch === (+model.exit_tick_time);\n            });\n            const exit_spot = model.make_exit_spot(exit_tick_idx + 1);\n            draw_x_line(el.chart, exit_spot);\n      };\n\n      function draw_tick(tick_idx) {\n            const tick = ticks[tick_idx -1];\n            el.chart.series[0].addPoint([tick_idx, tick.quote]);\n      };\n\n      function draw_entry_spot(tick_idx) {\n            const is_label_left = true;\n            const entry_spot = model.make_entry_spot(tick_idx);\n            draw_x_line(el.chart, entry_spot, is_label_left);\n      };\n\n      function draw_barrier(barrier) {\n            el.chart.yAxis[0].removePlotLine(barrier.id);\n            draw_y_line(el.chart, barrier);\n      };\n\n      function draw_x_line(chart, options, align_label_left) {\n            const label_x_position = align_label_left ? -15 : 5;\n   \n            chart.xAxis[0].addPlotLine({\n               value: options.value,\n               id: options.id || options.value,\n               label: {text: options.label || 'label', x:  label_x_position },\n               color: options.color || '#e98024',\n               width: options.width || 2,\n               dashStyle: options.dashStyle || false,\n            });\n      };\n\n      function draw_y_line(chart,options) {\n            chart.yAxis[0].addPlotLine({\n               id: options.id || options.label,\n               value: options.value,\n               label: {text: options.label, align: 'center'},\n               color: 'green',\n               width: 2,\n            });\n            /* Add plotline value to invisible seri to make the plotline always visible. */\n            chart.series[1].addPoint([1, options.value*1]);\n      };\n   }\n};\n\nconst register_ticks = (state, extra) => {\n   let proposal_open_contract;\n   let on_proposal_open_contract;\n   let on_tick;\n   let { tick_count } = extra;\n   /* No need to worry about WS connection getting closed, because the user will be logged out */\n   const add_tick  = (tick) => {\n      const is_or_after_contract_entry = (+tick.epoch) >= (+proposal_open_contract.entry_tick_time);\n      const is_new_tick = !state.ticks.array.some((state_tick) => state_tick.epoch * 1 === tick.epoch * 1);\n      const should_add_new_tick = is_new_tick && !state.ticks.contract_is_finished && is_or_after_contract_entry;\n\n      if (should_add_new_tick) {\n            const contract_is_finished = proposal_open_contract.status !== 'open' && !state.ticks.contract_is_finished;\n            state.buy.barrier = proposal_open_contract.barrier ? (+proposal_open_contract.barrier) : null;\n\n            if (contract_is_finished) {\n                  on_contract_finished(proposal_open_contract);\n                  update_chart();\n            }\n            tick_count--;\n            if (tick_count > -1) {\n                  add_tick_to_state(tick);\n            }\n      }\n   }\n\n   function add_tick_to_state(tick) {\n      const decimal_digits = chartingRequestMap.digits_after_decimal(extra.pip, extra.symbol);\n      const tooltip = make_tooltip(tick);\n\n      state.ticks.array.push({\n         quote: (+tick.quote),\n         epoch: (+tick.epoch),\n         number: state.ticks.array.length + 1,\n         tooltip,\n         decimal_digits,\n      });\n\n      function make_tooltip(tick) {\n            const tick_time = moment.utc(tick.epoch * 1000).format('dddd, MMM D, HH:mm:ss');\n            const { symbol_name } = extra;\n            const tick_quote_formatted = (+tick.quote).toFixed(decimal_digits);\n\n            return `${tick_time}<br/>${symbol_name} ${(+tick.quote).toFixed(decimal_digits)}`;\n      };\n   };\n\n   function update_chart() {\n            const tick_arr_copy = state.ticks.array.slice();\n            state.ticks.array = [...tick_arr_copy];\n    };\n\n   const on_contract_finished = (proposal_open_contract) => {\n      forget_stream_and_cb();\n\n      state.ticks.contract_is_finished = true;\n      state.ticks.is_path_dependent = proposal_open_contract.is_path_dependent ? proposal_open_contract.is_path_dependent : null;\n      state.ticks.exit_tick_time = proposal_open_contract.exit_tick_time ? proposal_open_contract.exit_tick_time : null;\n      state.ticks.sell_spot_time = proposal_open_contract.sell_spot_time ? proposal_open_contract.sell_spot_time : null;\n      state.ticks.status = proposal_open_contract.status;\n\n      state.buy.update();\n      state.back.visible = true;\n\n      function forget_stream_and_cb() {\n            const { contract_id } = extra;\n            liveapi.events.off('proposal_open_contract', on_proposal_open_contract);\n            liveapi.events.off('tick', on_tick);\n            liveapi.proposal_open_contract.forget(contract_id);\n      };\n   };\n\n   on_proposal_open_contract = liveapi.events.on('proposal_open_contract', (data) => {\n            const is_different_open_contract_stream = data.proposal_open_contract.contract_id !== extra.contract_id;\n            if (is_different_open_contract_stream) return;\n\n            if (data.error) {\n                  on_open_proposal_error(data);\n                  return;\n            }\n\n            ({ proposal_open_contract } = data);\n   });\n   \n  let temp_ticks = [];\n  let first_tick_epoch;\n  let is_getting_history = false;\n  on_tick = liveapi.events.on('tick', (data) => {\n      const is_different_stream = extra.symbol !== data.tick.symbol;\n      if (is_different_stream) return;\n      if (!first_tick_epoch) first_tick_epoch = data.tick.epoch;\n\n      const entry_tick_time = proposal_open_contract && proposal_open_contract.entry_tick_time;\n      if (!entry_tick_time) {\n            temp_ticks.push(data.tick);\n            return;\n      }\n\n      const has_missing_ticks = (first_tick_epoch > entry_tick_time);\n      if (has_missing_ticks) {\n            is_getting_history = true;\n            first_tick_epoch = entry_tick_time;\n            get_tick_history(entry_tick_time, extra.symbol);\n      }\n\n      if (is_getting_history) {\n            temp_ticks.push(data.tick);\n            return;\n      };\n\n      if (temp_ticks.length > 0) {\n            temp_ticks.forEach((stored_tick) => add_tick(stored_tick));\n            temp_ticks = [];\n      }\n\n      add_tick(data.tick);\n    });\n\n    function get_tick_history(start, ticks_history) {\n      liveapi.send({ ticks_history, end: 'latest', start, style: 'ticks', count: 5000})\n            .then((data) => {\n                  is_getting_history = false;\n                  data.history.prices.forEach((price, idx) => {\n                        temp_ticks.push({\n                              epoch: data.history.times[idx],\n                              quote: price,\n                              symbol: extra.symbol,\n                        });\n                  });\n                  temp_ticks.sort((a, b) => (+a.epoch) - (+b.epoch));\n            }).catch((err) => $.growl.error({ message: data.error.message }));\n    };\n\n   const on_open_proposal_error = (data) => {\n      $.growl.error({message: data.error.message});\n      liveapi.proposal_open_contract.forget(data.echo_req.contract_id);\n      liveapi.proposal_open_contract.subscribe(data.echo_req.contract_id);\n   };\n};\n\nexport const init = (data, extra, show_callback, hide_callback) => {\n   display_decimals = data.display_decimals || 3;\n   const root = $(html).i18n();\n   const { buy } = data;\n   const decimal_digits = chartingRequestMap.digits_after_decimal(extra.pip, extra.symbol);\n   const state = {\n      title: {\n         text: 'Contract Confirmation'.i18n(),\n      },\n      buy: {\n         barrier: null,\n         message: buy.longcode,\n         balance_after: buy.balance_after,\n         buy_price: (+buy.buy_price).toFixed(currencyFractionalDigits()),\n         purchase_time: buy.purchase_time,\n         start_time: buy.start_time,\n         transaction_id: buy.transaction_id,\n         payout: (+buy.payout).toFixed(currencyFractionalDigits()),\n         currency: extra.currency,\n         potential_profit : (buy.payout - buy.buy_price).toFixed(currencyFractionalDigits()),\n         potential_profit_text : 'Profit'.i18n(),\n         show_result: false,\n      },\n      spreads: {\n         amount_per_point: buy.amount_per_point || '0',\n         stop_loss_level: buy.stop_loss_level || '0',\n         stop_profit_level: buy.stop_profit_level || '0',\n      },\n      ticks: {\n         array: [],\n         contract_is_finished: false,\n         exit_tick_time: null,\n         sell_spot_time: null,\n         is_path_dependent: null,\n         make_exit_spot: (inx) => ({value: inx, label: 'Exit Spot'.i18n(), dashStyle: 'Dash'}),\n         make_entry_spot: (inx) => ({value: inx, label: 'Entry Spot'.i18n()}),\n         make_barrier: () => {\n            const { barrier } = state.buy;\n            if (barrier) {\n                  return { value: +barrier, label: 'Barrier ('.i18n() + addComma(barrier.toFixed(display_decimals)) + ')', id: 'plot-barrier-y'};\n            }\n            return null;\n         },\n         tick_count: extra.tick_count,\n         value: (extra.digits_value || '0') + '', // last digit value selected by the user\n         category: extra.category,\n         category_display: extra.category_display,\n\n         status: 'waiting', /* could be 'waiting', 'lost' or 'won' */\n         chart_visible: extra.show_tick_chart,\n      },\n      arrow: {\n         visible: !extra.show_tick_chart && extra.category.contract_category !== 'digits',\n      },\n      back: { visible: false }, /* back buttom */\n   };\n\n   if (Lookback.isLookback(extra.category_display.contract_type)) {\n     state.buy.payout = Lookback.formula(extra.category_display.contract_type, extra.amount);\n     state.buy.potential_profit = undefined;\n   }\n\n   state.buy.update = () => {\n      const { status } = state.ticks;\n      state.title.text = { waiting: 'Contract Confirmation'.i18n(),\n         won : 'This contract won'.i18n(),\n         lost: 'This contract lost'.i18n()\n      }[status];\n      if(status === 'lost') {\n         state.buy.potential_profit = (-state.buy.buy_price).toFixed(currencyFractionalDigits());\n         state.buy.payout = (0).toFixed(currencyFractionalDigits());\n         state.buy.potential_profit_text = 'Lost';\n      }\n      if(status === 'won') {\n         state.buy.balance_after = buy.balance_after*1 + state.buy.payout*1;\n         liveapi.sell_expired(); // to update balance immediately\n      }\n      state.buy.show_result = true;\n   }\n\n   state.back.onclick = () => hide_callback(root);\n   state.arrow.onclick = (e) => {\n      const $target = $(e.target);\n      if(!$target.hasClass('disabled')) {\n         $target.addClass('disabled');\n         require(['viewtransaction/viewTransaction'], (viewTransaction) => {\n            viewTransaction.init(extra.contract_id, extra.transaction_id)\n               .then(() => $target.removeClass('disabled'));\n         });\n      }\n   };\n\n   const view = rv.bind(root[0], state)\n\n   if(!state.arrow.visible) { register_ticks(state, extra); }\n   else { state.back.visible = true; }\n\n   show_callback(root);\n}\n\nexport default  { init }\n"]}